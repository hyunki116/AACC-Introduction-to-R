---
title: "Exploratory data analysis"
author: "Patrick Mathias"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(janitor)
library(lubridate)
```

# Exploratory Data Analysis

In this section of the course we will walk through a common workflow: exploring a new data set.

First let's refresh your memory on loading in a data set. We have an Excel file that contains our main data set in the data folder called "orders_data_set.xlsx". After loading the file into a variable (in this case a data frame) called "orders", look at the structure of the data using the `str` command

```{r load_data}
orders <- read_excel("data/orders_data_set.xlsx")
str(orders)
```

Which fields of the data frame are characters?

Which are numbers?

Of those fields above, which would be best represented as factors?


```{r load_data_clean_headers}
orders <- read_excel("data/orders_data_set.xlsx") %>%
  clean_names()
str(orders)
```

```{r glimpse}
glimpse(orders)
```

```{r summary}
summary(orders)
```

```{r convert_factor}
summary(orders$order_status_c_descr)
summary(as.factor(orders$order_status_c_descr))
```
```{r}
orders <- orders %>%
  mutate(department_fctr = as.factor(department))
summary(orders$department_fctr)
```

```{r convert_all_factors}
orders <- orders %>%
  mutate_if(is.character, as.factor)
summary(orders)
```

```{r skim}
library(skimr)
skim(orders)
```

```{r}
orders <- orders %>%
  mutate(order_week = floor_date(order_time, unit = "week"))
ggplot(orders, aes(x = order_week)) + 
  geom_histogram(binwidth = 7*24*60*60)
```

```{r cbc_analysis}
cbd_orders <- orders %>%
  filter(proc_code == "CBD")
table(cbd_orders$department, cbd_orders$order_status_c_descr)
```

```{r tabyl}
cbd_orders %>% 
  tabyl(department, order_status_c_descr) %>%
  adorn_totals("row") %>%
  adorn_percentages("row") %>%
  adorn_pct_formatting() %>%
  adorn_ns()
```

